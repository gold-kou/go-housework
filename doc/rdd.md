# 要件定義書(Requirement Definition Document)
## はじめに
各機能の要件を本ドキュメントにまとめます。
ドキュメントのメンテナンス性を考慮し、詳細に記載しすぎないようにしております。

正確なリクエストパラメータやレスポンスパラメータ情報は `openapi/openapi.yml` を確認ください。
RDB論理設計は `doc/rdb.md` を確認ください。

## 機能要件
### 認証系
#### ユーザ登録
- 正常系
    - ユーザ名、メールアドレス、パスワードを入力
    - パスワードをハッシュ化
    - ユーザテーブルにユーザ情報を登録
    - 正常レスポンス
- 異常系
    - ユーザ名が空であればエラーレスポンス
    - メールアドレスが空であればエラーレスポンス
    - パスワードが空であればエラーレスポンス
    - 登録済みメールアドレスであればエラーレスポンス
    - メールアドレス形式でなければエラーレスポンス
    - ユーザ名が1桁〜100桁でなければエラーレスポンス
    - 登録済みユーザ名であればエラーレスポンス(ユーザ名は一意) 
    - パスワードが6桁〜20桁でなければエラーレスポンス
- 備考
    - メールアドレス検証は省略

#### ユーザ削除
- 正常系
    - JWTをヘッダに格納して送信
    - トークン検証
    - 対象ユーザをDelete
    - 正常レスポンス
- 異常系
    - 世帯管理者であれば削除できないことを伝えるエラーレスポンス
    - トークンが不正であればエラーレスポンス
- 備考
    - 今後の機能開発で、世帯管理者削除時は関連する世帯テーブルや家事テーブルのレコードを全てDeleteするようにする。

#### ログイン
- 正常系
    - ユーザ名、パスワードを入力
    - JWTを生成する（有効期限24時間）
    - 正常系レスポンス
- 異常系
    - ユーザ名が空であればエラーレスポンス
    - パスワードが空であればエラーレスポンス
    - ユーザ名に誤りがあればエラーレスポンス
    - パスワードに誤りがあればエラーレスポンス

#### ログアウト
- 備考
    - バックエンドでのログアウト機能は有しない
    - （フロントエンドがあればローカルストレージを削除するなどの方法）

#### パスワード変更
- 正常系
    - ユーザ名、メールアドレス、新パスワードを入力
    - 新パスワードをRDBに登録
    - メールアドレス宛てにパスワードが変更されたことを通知する
    - 正常系レスポンス
- 備考
    - ユーザ名が空であればエラーレスポンス
    - メールアドレスが空であればエラーレスポンス
    - パスワードが空であればエラーレスポンス
    - 低優先で開発する
    - ユーザ名、メールアドレスを忘れた場合はランダムパスワードの発行と登録？新規登録？

#### 世帯管理者登録
- 備考
    - なし
    - 世帯作成時に自動で付与される

#### JWTのclaim仕様
- name(ユーザ名)
- iat(発行日時)
- exp(有効期限)

#### サービスロール種類
- head：世帯を作成したユーザです。世帯情報を管理する権限を有します。
- member：世帯に属する一般ユーザです。

### 世帯管理系
#### 世帯作成
- 正常系
    - 世帯名を入力
    - トークン検証
    - 世帯ID(uuid)払い出し
    - ユーザ情報を世帯テーブルにINSERT
    - リクストユーザを世帯管理者としてmembers_familiesテーブルにINSERT
    - 正常系レスポンス
- 異常系
    - 世帯名が空であればエラーレスポンス
    - 世帯名が1桁〜20桁でなければ
    - トークンが不正であればエラーレスポンス

#### 世帯詳細取得（世帯管理者のみ）
- 正常系
    - トークン検証・認可
    - 世帯IDでSELECT
    - 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    
#### 世帯更新(世帯管理者のみ)
- 正常系
    - 世帯名を入力
    - トークン検証・認可
    - 世帯名をUPDATE
    - 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    - 世帯名が空であればエラーレスポンス
    - 世帯名が1桁〜20桁でなければ  

#### 世帯削除(世帯管理者のみ)
- 正常系
    - 世帯IDを入力
    - トークン検証・認可
    - 世帯IDでDELETE
    - 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    - 世帯IDが空であればエラーレスポンス
    - 存在しない世帯IDであればエラーレスポンス

### 世帯メンバ管理系
#### 世帯メンバ追加（世帯管理者のみ）
- 正常系
    - ユーザ名を入力
    - トークン検証・認可
    - 世帯IDのレコードに追加するユーザ名をUPDATE
    - 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    - 既にそのユーザ名がいずれかの世帯に存在している場合はエラーレスポンス

#### 世帯メンバ一覧取得（世帯管理者のみ）
- 正常系
    - トークン検証・認可
    - トークンから抽出したユーザ名が属する世帯をmembers_famileisテーブルからSELECT
    - 世帯IDでSELECT
    - 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    - どの世帯にも属していない場合はエラーレスポンス
    
#### 世帯メンバ削除（世帯管理者のみ）
- 正常系
    - ユーザ名を入力
    - トークン検証・認可
    - 世帯ID、ユーザ名でDELETE
    - 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    - ユーザ名が空であればエラーレスポンス
    - 登録されていないユーザ名であればエラーレスポンス

### 家事タスク管理系
#### 家事タスク登録
- 正常系
    - 家事タスク名、担当者（ユーザ名）、ステータス、日付を入力
    - トークン検証
    - トークンから抽出したユーザ名が属する世帯をmembers_famileisテーブルからSELECT
    - 家事タスク情報をINSERT
    - 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    - 同一日付で重複したタスク名であればエラーレスポンス

#### 家事タスク一覧取得
- 正常系
    - オプションで日付を入力。日付指定なければ今日の日付。
    - トークン検証
    - リクエストユーザの世帯の家事タスクを日付でSELECT
	- 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    - パラメータの日付フォーマットが不正であればエラーレスポンス

#### 家事タスク更新
- 正常系
    - 家事タスクID、家事タスク名、担当者、ステータス、日付を入力
    - トークン検証・認可
    - リクエストパラメータの情報でUPDATE
    - 正常系レスポンス
- 異常系
    - トークンが不正であればエラーレスポンス
    - 家事タスクIDが空であればエラーレスポンス
    - 家事タスク名が空であればエラーレスポンス
    - 担当者が空であればエラーレスポンス
    - ステータスが空であればエラーレスポンス
    - 日付が空であればエラーレスポンス
    - タスクテーブルに存在しない家事タスクIDであればエラーレスポンス
    - ユーザテーブルに存在しない担当者名ユーザ名であればエラーレスポンス
    - ステータスが未完了か完了でなければエラーレスポンス

#### 家事タスク削除(家事タスク登録者のみ)
- 正常系
    - 家事タスクIDを入力
    - トークン検証・認可
    - 家事タスクIDでDELETE
    - 正常系レスポンス
- 異常系
    - 家事タスクIDが空であればエラーレスポンス
    - 存在しない家事タスクIDであればエラーレスポンス
    - 家事タスクを作成したユーザでなければエラーレスポンス

### メモ管理系
comming soon...
#### メモ作成
#### メモ取得
#### メモ更新
#### メモ削除
